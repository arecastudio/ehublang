<style type="text/css">

#kotak{
	padding:5px;
	background-color:#fff;
	border-radius:5px;
	margin-bottom:5px;
	border:1px solid #cce;
	overflow:auto;
	width:400px;
	float:left;
	margin-right:5px;
}
#map {
	height:400px;
	width: 60%;
	float: left;
	color: black;
	margin-bottom:5px;
}
</style>

<div class="path">
Home / Berkas / Registrasi
</div>

<strong>
Registrasi Pelanggan Baru
</strong>
<hr/>

<div style="display:inline;	overflow:auto;">
<div id="kotak">
	<form id="form" class="">
<div>
<label for="tx-id">Nomor Identitas</label>
<input type="text" id="tx-id" name="tx-id" placeholder="KTP / SIM / NPWP"/>
</div>


<div>
<label for="tx-nama">Nama</label>
<input type="text" id="tx-nama" name="tx-nama"/>
</div>


<div>
<label for="tx-alamat">Alamat</label>
<textarea id="tx-alamat" name="tx-alamat" style="width:99%;height:50px;"></textarea>
</div>

<div>
<label for="tx-rt">RT/RW</label>
<input type="text" id="tx-rt" name="tx-rt" style="width:50px;"/>&nbsp;/&nbsp;
<input type="text" id="tx-rw" name="tx-rw" style="width:50px;"/>
</div>

<div>
<label for="tx-hp">No. HP</label>
<input type="text" id="tx-hp" name="tx-hp"/>
</div>

<div>
<label for="tx-spl">No. SPL</label>
<input type="text" id="tx-spl" name="tx-spl"/>
</div>

<div>
	<label for="opt-upp">Area Service</label>
	<select id="opt-upp" name="opt-upp">
		<!-- auto-create-content -->
	</select>
</div>

<div>
<label for="lok-rmh">Lokasi Rmh</label>
<span id="lok-rmh"><span id="hasil"></span></span>
</div>

<input type="hidden" name="tx-pos-lat" id="tx-pos-lat" />
<input type="hidden" name="tx-pos-lon" id="tx-pos-lon" />

</form>
<hr/>
<div>
<button id="btn-submit" class="ui-button" style="float:right;">Simpan</button>
<button id="btn-reset" class="ui-button" style="">Reset</button>
</div>


</div><!--kotak-->


<div id="map"></div>
</div><!--display block-->

<div style="width: 100%;float: clear;overflow: auto;"></div>

<div id="msg" class="msg" style=""></div>

<table class="tablex" id="xreg-table">
<thead>
	<tr>
	<th>#</th>
	<th>ID</th>
	<th>Calon Pelanggan</th>
	<th>Alamat</th>
	<th>RT</th>
	<th>RW</th>
	<th>No. SPL</th>
	<th>UPP</th>
	<th>Tgl. Input</th>
	<th>DEL</th>
	</tr>
</thead>

<tbody id="tbody">
</tbody>
<tfoot>
	<tr>
		<td colspan="10" style="font-style:italic;font-size:80%;">Tabel ini hanya menampilkan draft calon pelanggan untuk bulan berjalan. Untuk melihat secara lengkap per tanggal, buka menu <strong>Data Registrasi<strong></td>
	</tr>
</tfoot>
</table>

<script type="text/javascript">

$(document).ready(function(){

/*	$('#opt-upp').selectmenu();*/

	$('#reg-table').DataTable();

	$('#opt-upp').load('ctrl/main.php?gif=upp');
	$('#tbody').load('ctrl/reg-pelanggan.php?gif=pel-baru');

	$('#btn-reset').click(function(){
		$('#form')[0].reset();
		$('#msg').css('display','none');
		initMap.clearMarkers();
		initMap.deleteMarkers();			    
		$('#hasil').html('');
	});

	$('#btn-submit').click(function(){
		$('#msg').css('display','none');
		if(
		$('#tx-id').val()!='' 
		&& $('#tx-nama').val()!='' 
		&& $('#tx-alamat').val()!='' 
		&& $('#tx-rt').val()!='' 
		&& $('#tx-rw').val()!='' 
		&& $('#tx-hp').val()!='' 
		&& $('#tx-spl').val()!='' 
		){
		var data=$('#form').serialize();
		$.ajax({
			type:'POST',
			url:'ctrl/reg-pelanggan.php',
			data:data,
			success:function(e){
				/*$('#msg').html(e);*/
				$('#form')[0].reset();
				$('#tbody').load('ctrl/reg-pelanggan.php?gif=pel-baru');
				$('#tx-id').focus();
				$('#hasil').html('');
				initMap.clearMarkers();
				initMap.deleteMarkers();			    
			},
			error:function(req,stat,err){
				$('#msg').css('display','block');
				$('#msg').html('Error msg: '+req.responseText);
			}
		});
		}else{
			$('#msg').css('display','block');
			$('#msg').html('Lengkapi form terlebih dahulu !');
		}
	});

	$('#tbody').delegate('.btn-del','click',function(){
		var id=$(this).attr('id');
		console.log('id_hapus: '+id);
		$.ajax({
			type:'POST',
			url:'ctrl/reg-pelanggan.php',
			data:{'id_hapus':id},
			success:function(e){				
				$('#msg').css('display','block');
				$('#msg').html(e);
				$('#tbody').load('ctrl/reg-pelanggan.php?gif=pel-baru');
				$('#tx-id').focus();
			},
			error:function(){
				$('#msg').html('Gagal menghapus data.');
			}
		});
	});

});

//pure javascript

function initMap() {

	var map;
      	var markers = [];


        var jayapura = {lat: -2.5916, lng: 140.6690};
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: jayapura
        });
        /*var marker = new google.maps.Marker({
          position: jayapura,
          map: map
        });*/
        map.setMapTypeId('satellite');



	google.maps.event.addListener(map, "click", function(event) {
    // get lat/lon of click
    var clickLat = event.latLng.lat();
    var clickLon = event.latLng.lng();

    // show in input box
    var result='{ Lat: '+clickLat.toFixed(5)+', Lon: '+clickLon.toFixed(5)+' }';
    console.log(result);
    //window.alert(result);
    document.getElementById('hasil').innerHTML=result;
    document.getElementById('tx-pos-lon').value=clickLon.toFixed(5);
    document.getElementById('tx-pos-lat').value=clickLat.toFixed(5);
    //document.getElementById("lon").value = clickLon.toFixed(5);
/*
    marker = new google.maps.Marker({
      position: new google.maps.LatLng(clickLat,clickLon),
      map: map
    });
		markers.push(marker);*/
    clearMarkers();
    deleteMarkers();
    addMarker(event.latLng);


  });


// Adds a marker to the map and push to the array.
      function addMarker(location) {
        var marker = new google.maps.Marker({
          position: location,
          map: map,
          mapTypeId: 'satellite'
        });
        markers.push(marker);
      }

      // Sets the map on all markers in the array.
      function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(map);
        }
      }

      // Removes the markers from the map, but keeps them in the array.
      function clearMarkers() {
        setMapOnAll(null);
      }

      // Shows any markers currently in the array.
      function showMarkers() {
        setMapOnAll(map);
      }

      // Deletes all markers in the array by removing references to them.
      function deleteMarkers() {
        clearMarkers();
        markers = [];
      }

initMap.clearMarkers=clearMarkers;
initMap.deleteMarkers=deleteMarkers;

}


</script>


<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbKSZYsGryBrvYDGHN55xEOtXpWqE6WIQ&callback=initMap">
</script>
